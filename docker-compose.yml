version: "3.8"

services:
  jenkins:
    build: ./jenkins
    image: jenkins-secure:latest
    ports:
      - "8080:8080"
      - "50000:50000"
    volumes:
      - jenkins_home:/var/jenkins_home
    privileged: true
    depends_on:
      - dind
    networks:
      - jenkins_net

  dind:
    image: docker:24-dind
    privileged: true
    networks:
      - jenkins_net
    volumes:
      - docker-data:/var/lib/docker

  bloodhound:
    image: specterops/bloodhound:latest
    depends_on:
      - bloodhound-db
      - bloodhound-graph-db
    ports:
      - "127.0.0.1:8081:8080"
    networks:
      - jenkins_net

  bloodhound-db:
    image: postgres:16
    environment:
      POSTGRES_USER: blood
      POSTGRES_PASSWORD: blood
      POSTGRES_DB: blood
    networks:
      - jenkins_net

  bloodhound-graph-db:
    image: neo4j:4.4
    environment:
      NEO4J_AUTH: neo4j/blood
    ports:
      - "7474:7474"
      - "7687:7687"
    networks:
      - jenkins_net

volumes:
  jenkins_home: {}
  docker-data: {}

networks:
  jenkins_net:
    driver: bridge
